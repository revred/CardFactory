@inject IJSRuntime JSRuntime
@implements IDisposable

<div class="carousel-container">
    @for (int i = 1; i <= 4; i++)
    {
        var slideNum = i;
        <div class="carousel-slide @(currentSlide == slideNum ? "active" : "")" id="slide@(slideNum)">
           @*  <div class="product-image">
                <img src="/images/@GetImageForSlide(slideNum)?v=1" alt="@GetAltTextForSlide(slideNum)" />
            </div> *@
            <div class="gradient-overlay"></div>
            <div class="carousel-content">
                <h1 class="hero-title">
                    @switch (slideNum)
                    {
                        case 1:
                            @("Strategic Play.")
                            <br />
                            @("Masterful Cards.")
                            ;
                            break;

                        case 2:
                            @("Rare Decks.")
                            <br />
                            @("Elite Gameplay.")
                            ;
                            break;

                        case 3:
                            @("Competitive Play.")
                            <br />
                            @("Pro Strategy.")
                            ;
                            break;

                        case 4:
                            @("Precision Cards.")
                            <br />
                            @("Timeless Play.")
                            ;
                            break;
                    }
                </h1>
                <div class="action-button">
                    <a href="@GetLinkForSlide(slideNum)" class="btn btn-explore">@GetButtonTextForSlide(slideNum)</a>
                </div>
            </div>
        </div>
    }

    <div class="carousel-dots">
        @for (int i = 1; i <= 4; i++)
        {
            var dotNum = i;
            <span class="dot @(currentSlide == dotNum ? "active" : "")" @onclick="() => ActivateSlide(dotNum)"></span>
        }
    </div>
</div>

@code {
    private int currentSlide = 1;
    private System.Threading.Timer? carouselTimer;

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            carouselTimer = new System.Threading.Timer(
                _ => InvokeAsync(() =>
                {
                    NextSlide();
                    StateHasChanged();
                }),
                null,
                TimeSpan.FromSeconds(5),
                TimeSpan.FromSeconds(5)
            );
        }
    }

    private void NextSlide() => currentSlide = currentSlide >= 4 ? 1 : currentSlide + 1;

    private void ActivateSlide(int slideNumber)
    {
        currentSlide = slideNumber;
        carouselTimer?.Change(TimeSpan.FromSeconds(5), TimeSpan.FromSeconds(5));
    }

    // private string GetImageForSlide(int slideNumber) => "nano-bubble.jpg";

    // private string GetAltTextForSlide(int slideNumber) => slideNumber switch
    // {
    //     1 => "Precision Machined Part",
    //     2 => "Product Assembly",
    //     3 => "Customer Solutions",
    //     4 => "Design Innovation",
    //     _ => "Precision Part"
    // };

    private string GetLinkForSlide(int slideNumber) => slideNumber switch
    {
        1 => "products",
        2 => "services",
        3 => "contact",
        4 => "about",
        _ => "products"
    };

    private string GetButtonTextForSlide(int slideNumber) => slideNumber switch
    {
        1 => "Explore Products",
        2 => "Our Services",
        3 => "Contact Us",
        4 => "About Us",
        _ => "Learn More"
    };

    public void Dispose() => carouselTimer?.Dispose();
}
